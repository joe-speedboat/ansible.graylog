---
- name: setup single node
  hosts: graylog.domain.tld
  become: True
  gather_facts: True
  vars:
    reconfigure_graylog: False
    graylog_admin_password: "LogMeIn."
    graylog_transport_email_enabled: True
    graylog_transport_email_hostname: mail.domain.tld
    graylog_transport_email_port: 587
    graylog_transport_email_use_auth: True
    graylog_transport_email_use_tls: True
    graylog_transport_email_auth_username: "smtp@domain.tld"
    graylog_transport_email_auth_password: "secret..."
    graylog_transport_email_from_email: "smtp@domain.tld"

  pre_tasks:
  - name: Install firewalld
    package:
      name: firewalld
      state: present

  - name: Enable and start firewalld
    systemd:
      name: firewalld
      enabled: yes
      state: started

  - name: Open port 443/tcp
    firewalld:
      port: 443/tcp
      permanent: yes
      state: enabled
      immediate: yes

  - name: Open port 514/udp
    firewalld:
      port: 514/udp
      permanent: yes
      state: enabled
      immediate: yes

  - name: Open port 514/tcp
    firewalld:
      port: 514/tcp
      permanent: yes
      state: enabled
      immediate: yes
  roles:
  - joe-speedboat.graylog

